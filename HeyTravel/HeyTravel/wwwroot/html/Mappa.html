<!DOCTYPE html>
<html>
<head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
    <div id="map" style="width:600px; height:400px;"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZGFueXJlZHMiLCJhIjoiY2t6bjEyamNxMDN6NzJucXVnZjZ2enM3eCJ9.ieT8jUJor2Z0q69as5-WYQ';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/danyreds/ckzmpnpey001h15oatavzcetr',
            center: [9.8, 45.75],
            zoom: 2.5
        });

        map.on('load', function () {

            map.addSource('COVID', {
                type: 'geojson',
                data: 'https://www.combattentibergamaschi.it/mappa.json'
            });

            map.addLayer({
                id: 'covid-cases',
                type: 'fill',
                source: 'COVID',
                'paint': {
                    'fill-color': "#AA1100",
                    'fill-opacity': {
                        property: 'casi',
                        stops: [
                            [0, 0],
                            [1, 0.15],
                            [20, 0.5],
                            [35, 0.7],
                            [100, 0.8],
                        ]
                    }
                }
            });
        });

        map.on('click', 'covid-cases', function (e) {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var HTML = 'Country: <b>' + e.features[0].properties.name + '</b>' + ' ' + e.features[0].properties.casi + ' cases';
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(HTML)
                .addTo(map);
        });

        // Change the cursor to a pointer when the mouse is over the states layer.
        map.on('mouseenter', 'covid-cases', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'covid-cases', function () {
            map.getCanvas().style.cursor = '';
        });</script>
</body>
</html>